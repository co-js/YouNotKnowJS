# 编译原理
尽管通常将Javascript归类为“动态”或“解释执行”语言，但事实上它是一门编译语言。
它不像很多传统编译语言一样被提前编译好，编译结果也不能在分布式系统中进行移植。

尽管如此，Javascript引擎进行编译的步骤和传统的编译语言非常相似，在某些环节上可能比
预想的要复杂。

传统的编译语言过程，一段源代码到它执行一般要经过3个步骤，简单地称作"编译":

1. 分词/词法分析: 将字符串分解成有意义的代码块，这些代码块称为词法单位。例如var a=2;
   这段程序通常会被分解成下面这些词法单位:var,a,=,2,;

2. 解析/语法分析： 这个过程会将词法单元流(数组)转换成一个由嵌套元素组成的代表了程序语法结构的数。
   这个数被称为“抽象语法书”（AST）;
   
3. 代码生成： 将AST转换为可执行代码的过程被称为代码生成。这个过程与语言、目标平台等息息相关。

Javascript引擎没有大量的时间来优化，因为Javascript编译不发生在构建之前，与其他语言不通。
Javascript编译发生在执行前的几微秒(甚至更短)的时间里，为了确保最快的性能，JS引擎用尽了各种办法(比如JIT)来保证
性能最佳。

简单地说，任何Javascript代码片段在执行前都要进行编译。因此，Javascript编译器首先对var a=2;这段代码进行编译，
然后做好执行它的准备，并且通常马上就会执行它。

# 理解作用域
认识下程序执行中的几个角色：
1. 引擎: 从头到尾负责整个Javascript程序的编译及执行过程。
2. 编译器：引擎的朋友之一，负责语法分析和代码生成等脏活累活
3. 作用域：引擎的另一个朋友，负责收集并维护由所有声明的标识符(变量)组成的一系列查询，并实施一套严格的柜规则，
   确定当前执行的代码对这些标识符的访问权限。

### 对话
当你看到`var a=2;`这段程序时，你很可能认为它是一个声明。但是我们的新朋友引擎却不这么看，事实上，引擎会看作两个分开的声明，
一个编译器会在编译阶段处理，另一个引擎会在执行过程中处理。

所以，让我们看看引擎和他的朋友们是如何协同工作的。

首先，编译器会将这段程序分解成词法单元，然后将词法单元解析成一个树结构。但是当编译器
在生成代码时，它对待这段程序可能与预想的不太一样。

一个有理由的假设编译器所产生的代码能够用下面的伪代码进行概括:"用一个变量分配内存，将其命名为`a`，然后将`2`值存入内存"，然后，
这并不完全正确。

实际过程是这样的:

1. 遇到`var a`，编译器询问作用域(Scope)`a`变量在当前作用域下是否已存在，如果是，编译器忽视这个声明并继续。
   否则，编译器将要求作用域在当前作用域下声明一个新的变量，并命名为`a`。
   
2. 编译器然后生成代码，为引擎后面执行，这些代码被用来处理`a=2`这个赋值操作。引擎运行时会首先询问作用域，在当前作用域集合中是否
   有命名为`a`的变量，如果有，引擎直接使用它。如果没有，引擎会继续查找该标量。
   
如果引擎找到这个变量，那么就将2分配给它，如果没有，引擎将举起手并抛出一个错误！

